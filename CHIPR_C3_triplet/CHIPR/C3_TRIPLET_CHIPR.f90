!####################################################################################
! CHIPR TRIPLET GROUND-STATE PES OF C3 IN A.U
!
! C. M. R. ROCHA AND A. J. C. VARANDAS, J. PHYS. CHEM. A (SUBMITTED) 2019
!
! TWO-BODY AND THREE-BODY TERMS USING CHIPR 
!
! THREE-BODY TERMS CALIBRATED FROM 5999 MRCI(Q)/GUSTE(d,t) ENERGIES
! RMSD=2.7 kJ MOL-1
!
! THIS VERSION IS THE PURELLY AB INITIO PES
!
! R IS A 3D VECTOR OF BOND DISTANCES IN BOHR
! POT IS THE POTENTIAL IN HARTREE
!
! SET DER=.TRUE. TO CALCULATE THE GRADIENT IN INTERNAL COORDINATES
! THE DERIVATIVES ARE KEPT INTO THE 3D VECTOR DVDR    
!
!####################################################################################

      SUBROUTINE PES(R,POT,DER,DVDR) 
      IMPLICIT NONE
      INTEGER, PARAMETER :: NX=3    
      DOUBLE PRECISION, DIMENSION(NX) :: R
      DOUBLE PRECISION :: POT
      DOUBLE PRECISION :: SUMV2,V3
      LOGICAL :: DER
      DOUBLE PRECISION, DIMENSION(NX) :: DVDR3BD
      DOUBLE PRECISION, DIMENSION(NX) :: DVDR2BD
      DOUBLE PRECISION, DIMENSION(NX) :: DVDR
      CALL SUM2BD(R(1),R(2),R(3),SUMV2)
      CALL CHIPR_TRIAT(R,V3,DER,DVDR3BD)
      POT=SUMV2+V3

!###### CALCULATING SEMI-NUMERIC DERIVATIVES OF V WITH RESPECT TO R IF DER=.TRUE.
!###### NUMERIC DERIVATIVES FOR TWO-BODY TERMS
!###### ANALYTIC DERIVATIVES FOR THREE-BODY TERMS

      IF (DER) THEN
        CALL INTDERIVE(R,DVDR2BD,NX)
        DVDR(1)=DVDR2BD(1)+DVDR3BD(1)
        DVDR(2)=DVDR2BD(2)+DVDR3BD(2)
        DVDR(3)=DVDR2BD(3)+DVDR3BD(3)
      ELSE        
        DVDR(1)=1000
        DVDR(2)=1000
        DVDR(3)=1000
      END IF

!######

      RETURN
      END

!####################################################################################
! CALCULATES DERIVATIVES OF THE POTENTIAL WITH RESPECT TO CARTESIAN COORDINATES
! THIS USES THE CHAIN RULE
!####################################################################################

      SUBROUTINE CARTDERPES(X,DVDX)
      IMPLICIT NONE 
      INTEGER :: I
      INTEGER, PARAMETER :: NATOM=3     
      DOUBLE PRECISION, DIMENSION(3*NATOM) :: X
      DOUBLE PRECISION, DIMENSION(3*NATOM) :: DVDX,O
      DOUBLE PRECISION, DIMENSION(NATOM) :: Y,R,DVDR
      DOUBLE PRECISION :: V
!
!     This subprogram uses the chain rule to calculate the derivatives of the
!     energy with respect to the cartesian coordinates from the derivatives
!     with respect to the internal coordinates for a three-body system.
!     The convention assumed in this program is as follows:
!
!     R(1) = R(A-B)
!     R(2) = R(A-C)
!     R(3) = R(B-C)
!     X(1) - X(3) : X, Y, Z for atom A
!     X(4) - X(6) : X, Y, Z for atom B
!     X(7) - X(9) : X, Y, Z for atom C
!
      CALL CART2INTER(X,O,3*NATOM)

      R(1)=O(1)
      R(2)=O(2)
      R(3)=O(3)

      CALL PES(R,V,.TRUE.,DVDR) 

      DO I=1,3
        Y(I)=DVDR(I)/R(I)
      END DO

      DVDX(1)=-Y(1)*(X(4)-X(1))-Y(2)*(X(7)-X(1)) 
      DVDX(2)=-Y(1)*(X(5)-X(2))-Y(2)*(X(8)-X(2)) 
      DVDX(3)=-Y(1)*(X(6)-X(3))-Y(2)*(X(9)-X(3)) 
      DVDX(4)= Y(1)*(X(4)-X(1))-Y(3)*(X(7)-X(4)) 
      DVDX(5)= Y(1)*(X(5)-X(2))-Y(3)*(X(8)-X(5))
      DVDX(6)= Y(1)*(X(6)-X(3))-Y(3)*(X(9)-X(6))
      DVDX(7)= Y(2)*(X(7)-X(1))+Y(3)*(X(7)-X(4))
      DVDX(8)= Y(2)*(X(8)-X(2))+Y(3)*(X(8)-X(5))
      DVDX(9)= Y(2)*(X(9)-X(3))+Y(3)*(X(9)-X(6))

      RETURN
      END

!####################################################################################
! CONVERT CARTEZIAN TO INTERPARTICLE DISTANCES (A.U)
!####################################################################################

      SUBROUTINE CART2INTER(X,R,NTA)
      IMPLICIT REAL*8 (A-H,O-Z)
      PARAMETER(NA=3,NT=3*NA)
      DIMENSION X(NT),R(NT)
      K=0
      DO I=1,NTA,3
       DO J=I,NTA,3
        IF(I.NE.J)THEN
         K=K+1
         R(K)=SQRT((X(I)-X(J))**2+(X(I+1)-X(J+1))**2+&
     &   (X(I+2)-X(J+2))**2)
        ENDIF
       ENDDO
      ENDDO
      RETURN
      END

!###############################################################################
! NUMERICAL GRADIENT OF THE SUM OF TWO BODIES IN INTERNAL COORDINATES
! THIS APPROACH USES RICHARDSON'S EXTRAPOLATION FORMULA
!###############################################################################

      SUBROUTINE INTDERIVE(X,VAL,NTA)
      IMPLICIT REAL*8(A-H,O-Z)
      PARAMETER (PREC=1.0D-4)
      DIMENSION X(NTA),VAL(NTA)
      DO I=1,NTA
        VAL(I)=DVDR(X,PREC,I,NTA)
      END DO
      RETURN
      END

      FUNCTION DVDR(X,STEP,I,NTA)
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION X(NTA),XD(NTA)
      DO J=1,NTA
        XD(J)=X(J)
      END DO
      XD(I)=X(I)-STEP
      FMIN1=VNUM(XD,NTA)
      XD(I)=X(I)+STEP
      FMAX1=VNUM(XD,NTA)
      XD(I)=X(I)-2*STEP
      FMIN2=VNUM(XD,NTA)
      XD(I)=X(I)+2*STEP
      FMAX2=VNUM(XD,NTA)
      DVDR=(FMIN2-8.0*FMIN1+8.0*FMAX1-FMAX2)/(12.D0*STEP)
      RETURN
      END

      FUNCTION VNUM(X,NTA)
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION X(NTA)
      CALL SUM2BD(X(1),X(2),X(3),VNUM)
      RETURN
      END

!######################################################################################################

      SUBROUTINE CHIPR_TRIAT(R,POT,DER,DVDR)
      IMPLICIT NONE
      CHARACTER(LEN=3), PARAMETER :: MOLTYP="A3"
      INTEGER, PARAMETER :: DEG=1
      INTEGER, PARAMETER :: NC=705
      INTEGER, PARAMETER :: NX=3
      INTEGER :: I,J,K,L,M,S,O,ID
      INTEGER :: POLORDER
      INTEGER, DIMENSION(DEG) :: BSORDER,NCBAS
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: POL,BS
      DOUBLE PRECISION, DIMENSION(3) :: R
      DOUBLE PRECISION :: POT,REPDAMP
      INTEGER :: NCPOL,NCTOTAL,SUMC
      DOUBLE PRECISION, DIMENSION(NX) :: Y
      INTEGER :: TOTNUM,MNUM
      INTEGER, DIMENSION(3,6) :: P
      LOGICAL :: DER
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY1
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY2
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY3
      DOUBLE PRECISION, DIMENSION(NX) :: DVDR,DYDR

      C(  1)=  0.386462686309568504D+01
      C(  2)= -0.164070340740438724D+03
      C(  3)=  0.136650571156685929D+01
      C(  4)=  0.594066162558292763D+04
      C(  5)= -0.546477967176414313D+04
      C(  6)=  0.183929701733514275D+04
      C(  7)= -0.411484961577390204D+05
      C(  8)=  0.465346682154638984D+05
      C(  9)= -0.201479044882052622D+05
      C( 10)= -0.106266971129748049D+04
      C( 11)=  0.105129333333067843D+06
      C( 12)=  0.287366233979977333D+05
      C( 13)= -0.175843553177008784D+06
      C( 14)=  0.848014350072227535D+05
      C( 15)= -0.652616109502490726D+05
      C( 16)=  0.687610666957922513D+05
      C( 17)= -0.824770458315127325D+05
      C( 18)= -0.228966336982557521D+06
      C( 19)=  0.496001565208565735D+06
      C( 20)= -0.147135788096068572D+06
      C( 21)= -0.196825500374073818D+04
      C( 22)=  0.412547120801116456D+06
      C( 23)= -0.423924571153475728D+06
      C( 24)= -0.289628220453600661D+05
      C( 25)= -0.164119875379085424D+06
      C( 26)=  0.113606806152462712D+06
      C( 27)= -0.503364434600585490D+06
      C( 28)= -0.931645031300408300D+04
      C( 29)=  0.306355800293331966D+06
      C( 30)= -0.781411000648871181D+06
      C( 31)=  0.667840341512434970D+05
      C( 32)=  0.492959098238230392D+06
      C( 33)= -0.140439067081986141D+06
      C( 34)=  0.535783144921971834D+06
      C( 35)=  0.316492429735922837D+06
      C( 36)= -0.263191665884998201D+03
      C( 37)=  0.468330498258402047D+06
      C( 38)= -0.322067137468170622D+05
      C( 39)= -0.109943240767227928D+07
      C( 40)= -0.201933304945216252D+06
      C( 41)=  0.840807848529611132D+06
      C( 42)=  0.914569881201875745D+06
      C( 43)= -0.394969927406983974D+06
      C( 44)=  0.468655104409140244D+06
      C( 45)=  0.565470036196962581D+06
      C( 46)= -0.803256314635783201D+06
      C( 47)=  0.475311931162403489D+06
      C( 48)=  0.877056189519908075D+05
      C( 49)= -0.402104521226408659D+06
      C( 50)= -0.504692505928197352D+06
      C( 51)= -0.878469432875571511D+05
      C( 52)=  0.165611433509597252D+07
      C( 53)= -0.121656931896444899D+07
      C( 54)=  0.884262131974278484D+06
      C( 55)= -0.188322133399405191D+07
      C( 56)= -0.720437908603700227D+06
      C( 57)=  0.251332616845693876D+06
      C( 58)= -0.535172339965660012D+04
      C( 59)= -0.878706024441424915D+03
      C( 60)= -0.249303517025618094D+05
      C( 61)= -0.399360973575325670D+04
      C( 62)= -0.107991348420195375D+07
      C( 63)=  0.480309770961557864D+06
      C( 64)=  0.144359064771516528D+07
      C( 65)=  0.459367991809543967D+07
      C( 66)=  0.110411095646536894D+06
      C( 67)= -0.179148465572928800D+07
      C( 68)= -0.175824683433538041D-01
      C( 69)= -0.903363882408217323D+05
      C( 70)=  0.190726092384676449D+06
      C( 71)= -0.515995806228434049D+04
      C( 72)= -0.201351868607002450D+07
      C( 73)= -0.765268079156843829D+06
      C( 74)= -0.674263074700887315D+07
      C( 75)=  0.381434763608807058D+06
      C( 76)=  0.275952510072562518D+07
      C( 77)= -0.290499452501060069D+07
      C( 78)=  0.146439056385161378D+07
      C( 79)= -0.386353287657811365D+06
      C( 80)= -0.165570288952999702D+07
      C( 81)= -0.821392491639254558D+02
      C( 82)= -0.545179297968710400D+07
      C( 83)=  0.128669768245610595D+07
      C( 84)=  0.392840055047508758D+04
      C( 85)= -0.171244951927851094D+07
      C( 86)= -0.528238854746572815D+04
      C( 87)=  0.164611428449600982D+07
      C( 88)=  0.132126536321979156D+07
      C( 89)=  0.243783386917905556D+07
      C( 90)=  0.189741459249548009D+07
      C( 91)=  0.117812970625130197D+04
      C( 92)=  0.404801736171090696D+07
      C( 93)=  0.793365421890168800D+06
      C( 94)= -0.357791020895039692D+05
      C( 95)= -0.139543231313403671D+01
      C( 96)= -0.419813425719083977D+01
      C( 97)=  0.323444998093351629D+07
      C( 98)=  0.856278029792423826D+06
      C( 99)=  0.142255917834987006D+00
      C(100)= -0.217572292258743383D+07
      C(101)=  0.829937478479702986D+05
      C(102)=  0.209572409792559594D+07
      C(103)=  0.616175026903293110D+04
      C(104)= -0.562007304357786570D+07
      C(105)=  0.283963316780139168D+06
      C(106)=  0.303532069061397607D+02
      C(107)= -0.132924837776597613D+07
      C(108)=  0.537860011326507447D+05
      C(109)= -0.878101016674569459D+06
      C(110)= -0.254903479186414827D+01
      C(111)= -0.159395983478838066D+07
      C(112)=  0.110355129660328142D+08
      C(113)=  0.371800440138146933D+07
      C(114)= -0.338211904683074774D+07
      C(115)= -0.232573766033829749D+07
      C(116)=  0.564600981012214068D+07
      C(117)=  0.216413105607046699D+07
      C(118)=  0.118775121517732204D+07
      C(119)=  0.363776010460503120D+07
      C(120)= -0.340930368700196454D+07
      C(121)= -0.139333710602482641D+07
      C(122)=  0.638155253402769798D+06
      C(123)=  0.413298902613121551D+07
      C(124)= -0.855835380753751285D+07
      C(125)=  0.930903018531226189D+04
      C(126)= -0.427422775554060005D+07
      C(127)=  0.744287432505308464D+07
      C(128)=  0.136816544491493795D+08
      C(129)=  0.127807340726956185D+08
      C(130)= -0.110783887228928152D+08
      C(131)= -0.706831071566507779D+07
      C(132)= -0.108224045292860275D+06
      C(133)= -0.833531024908608058D+06
      C(134)= -0.107882665627681147D+08
      C(135)=  0.116237540576072074D+08
      C(136)= -0.799615053139260598D+07
      C(137)=  0.683923129990253225D+07
      C(138)=  0.152356936959359991D+05
      C(139)= -0.349714145926694013D+07
      C(140)= -0.833698789967783168D+07
      C(141)= -0.749162661306171212D+07
      C(142)=  0.534174839569014031D+07
      C(143)= -0.697272494506542478D+07
      C(144)=  0.975704784493953735D+07
      C(145)= -0.801353356090133358D+07
      C(146)=  0.510442221873073088D+01
      C(147)=  0.892683207053336147D+01
      C(148)= -0.143951275691942200D+08
      C(149)= -0.172080162112242659D+07
      C(150)=  0.146333166476405468D+08
      C(151)=  0.167383831971946899D+08
      C(152)= -0.372886157474681735D+07
      C(153)=  0.226993333195227906D+08
      C(154)= -0.143255642105382867D+08
      C(155)= -0.129893833297079839D+08
      C(156)= -0.308642905840877332D+08
      C(157)= -0.181628906245966516D+08
      C(158)=  0.433491387812812105D+08
      C(159)=  0.676631203361410275D+07
      C(160)= -0.259130313897013020D+00
      C(161)= -0.961687765642873943D+07
      C(162)=  0.517456277323312008D+01
      C(163)= -0.954764685009295680D+07
      C(164)=  0.528658799552335190D+00
      C(165)=  0.171143291579988960D+06
      C(166)=  0.292257712662187172D+07
      C(167)=  0.636572789685283136D+07
      C(168)= -0.224761384416173138D+08
      C(169)= -0.127610350221335851D+08
      C(170)= -0.215765049424951933D+08
      C(171)= -0.185157996439657477D+07
      C(172)=  0.833408767796584126D+07
      C(173)=  0.464798656919078156D+07
      C(174)=  0.180800452303782925D+08
      C(175)= -0.917335487233920954D+07
      C(176)= -0.478531052602523845D+07
      C(177)=  0.144587474624043945D+08
      C(178)=  0.171547678450389877D+08
      C(179)= -0.169633099706774810D+07
      C(180)= -0.275554110375516862D+08
      C(181)=  0.311808379863139689D+08
      C(182)=  0.721591452277420554D+07
      C(183)= -0.126093994285622947D+08
      C(184)=  0.350830001008094405D+05
      C(185)= -0.438553308708212301D+08
      C(186)= -0.333407868351951838D+08
      C(187)=  0.543348450918029845D+08
      C(188)= -0.688191786799972970D+07
      C(189)=  0.263269719674374834D+08
      C(190)= -0.786502292794325228D+02
      C(191)= -0.122184650683076866D+07
      C(192)= -0.778847871111222630D+05
      C(193)=  0.342459288507881714D+07
      C(194)= -0.110116452321333084D+08
      C(195)=  0.201261170329717621D+08
      C(196)=  0.181327144860393517D+08
      C(197)= -0.286799910762527725D+07
      C(198)= -0.108213523826157134D+08
      C(199)=  0.713060724239228172D+00
      C(200)=  0.115025923937183776D+06
      C(201)=  0.281230631887282841D+08
      C(202)= -0.167934266525046514D+05
      C(203)=  0.599405529788874105D+02
      C(204)= -0.269990479973975243D+04
      C(205)=  0.112379469777573599D+07
      C(206)=  0.214728820388520658D+08
      C(207)= -0.165441102660050448D+08
      C(208)=  0.322836733364111818D+08
      C(209)=  0.237017195763823256D+06
      C(210)= -0.429112893354753107D+08
      C(211)=  0.570003063182277977D+08
      C(212)=  0.467064999735803902D+08
      C(213)=  0.339297717310808375D+08
      C(214)= -0.122271582230637092D+08
      C(215)=  0.973739051453130879D+07
      C(216)= -0.593646046950091347D+08
      C(217)= -0.663562296538148075D+08
      C(218)= -0.405976655894962279D+07
      C(219)=  0.786264280664065182D+08
      C(220)= -0.109204908988351468D+08
      C(221)=  0.253097778337490149D+08
      C(222)= -0.247334369080773667D+08
      C(223)= -0.366138953869888978D+07
      C(224)= -0.437955064935936034D+08
      C(225)=  0.361342107202808410D+08
      C(226)=  0.165027251049523689D+08
      C(227)= -0.157805452567070816D+08
      C(228)= -0.595364718303564861D+08
      C(229)= -0.111782915638171147D+03
      C(230)=  0.734902567933269404D+07
      C(231)=  0.552554321561603770D+08
      C(232)=  0.601661529328814223D+08
      C(233)= -0.281908449999750592D+08
      C(234)=  0.545908126279407367D+07
      C(235)= -0.162993096643027868D+08
      C(236)= -0.249384616817251630D+08
      C(237)= -0.178199523329258809D+06
      C(238)=  0.688283439799518287D+08
      C(239)=  0.563785141822805861D+06
      C(240)= -0.419209807013922255D+05
      C(241)= -0.576943260261163712D+08
      C(242)= -0.825466742070768028D+08
      C(243)= -0.663709367215185985D+08
      C(244)= -0.944825212311260253D+08
      C(245)=  0.734274224333852082D+08
      C(246)=  0.356874410632450879D+08
      C(247)=  0.790361466078581810D+08
      C(248)=  0.771682446062758416D+08
      C(249)= -0.585620868054117262D+08
      C(250)= -0.565546977497173026D+08
      C(251)= -0.695553965075203776D+08
      C(252)= -0.764317227010574639D+08
      C(253)= -0.461840975582094193D+08
      C(254)= -0.123288103432185203D+07
      C(255)=  0.177094438884616606D+08
      C(256)= -0.956874010479725075D+04
      C(257)=  0.144862389942891467D+08
      C(258)= -0.586207142941665575D+08
      C(259)= -0.499223183290395811D+08
      C(260)=  0.552429289963045704D+02
      C(261)= -0.163181768882941850D+07
      C(262)=  0.194263156149757393D+08
      C(263)=  0.246903197050104663D+07
      C(264)=  0.234735475801909110D+07
      C(265)= -0.324525889978753626D+08
      C(266)=  0.535706769212359637D+08
      C(267)= -0.325003472399994619D+08
      C(268)=  0.513113711422717348D+08
      C(269)=  0.194237284470249265D+08
      C(270)= -0.251088151150525175D+08
      C(271)=  0.529738283852853552D+08
      C(272)= -0.628214268531709604D+05
      C(273)= -0.515821083421782851D+08
      C(274)= -0.452129332280869484D+08
      C(275)=  0.165402545939466059D+09
      C(276)= -0.414580819556501582D+08
      C(277)= -0.850372207740547210D+08
      C(278)= -0.147049070983322952D+08
      C(279)=  0.535216522197716311D+08
      C(280)= -0.829653346956873089D+08
      C(281)= -0.126580667436876878D+09
      C(282)=  0.345459316658869758D+08
      C(283)= -0.375560440986494571D+08
      C(284)=  0.117897553507444769D+09
      C(285)=  0.144392325537598193D+09
      C(286)=  0.301733682162267491D+08
      C(287)=  0.668367409418370053D+08
      C(288)= -0.479943196287087351D+08
      C(289)= -0.133740970734640596D+01
      C(290)= -0.112249304177569777D+09
      C(291)=  0.615258876777558252D+08
      C(292)=  0.418447685374310254D+03
      C(293)=  0.865704305552286655D+08
      C(294)= -0.286779039760492481D+08
      C(295)=  0.159377750260621272D+08
      C(296)= -0.213998818570050634D+08
      C(297)=  0.116063842862110212D+08
      C(298)=  0.897899218775052077D+03
      C(299)=  0.576030931849952787D+08
      C(300)= -0.591207759814174566D+07
      C(301)= -0.730268818813881427D+08
      C(302)=  0.692903663049481511D+08
      C(303)=  0.499917373817384839D+08
      C(304)=  0.718548493092974126D+08
      C(305)= -0.676727227168784440D+08
      C(306)= -0.150405449068333069D+07
      C(307)=  0.187287789251625501D+08
      C(308)= -0.545304944439832941D+08
      C(309)=  0.916743293225164115D+08
      C(310)= -0.402350106458656569D+03
      C(311)= -0.757941286488061845D+08
      C(312)=  0.135078049848364711D+09
      C(313)=  0.107238095605589882D+09
      C(314)= -0.139065614310157508D+09
      C(315)=  0.174091788284730256D+09
      C(316)= -0.100348152636076454D+08
      C(317)= -0.186046620337421507D+09
      C(318)= -0.975444572069500983D+08
      C(319)=  0.190121080342686772D+08
      C(320)= -0.928488832087469101D+08
      C(321)= -0.162894296617259502D+09
      C(322)=  0.131522307986930587D+01
      C(323)=  0.635902796971568465D+08
      C(324)= -0.484489801807977334D+08
      C(325)=  0.101969308458226845D+09
      C(326)=  0.726833289745701998D+08
      C(327)=  0.215802548604931831D+09
      C(328)= -0.358126988735353723D+08
      C(329)= -0.113436810387704596D+09
      C(330)= -0.576120844455416314D+06
      C(331)=  0.119503034072731286D+09
      C(332)= -0.691297121845252812D+08
      C(333)=  0.152061507246922106D+09
      C(334)=  0.218460145214267015D+09
      C(335)=  0.140941410644769937D+09
      C(336)=  0.449410679032283872D+08
      C(337)= -0.147552630084336251D+09
      C(338)=  0.455198686201960470D+03
      C(339)= -0.157148872470094919D+09
      C(340)=  0.822791517197841927D+03
      C(341)=  0.248890338599490821D+09
      C(342)=  0.931804492411251068D+08
      C(343)=  0.515307969192987382D+08
      C(344)= -0.146571206858828038D+09
      C(345)=  0.552813746598252465D+03
      C(346)= -0.150947042579000397D+07
      C(347)= -0.973106879798005223D+08
      C(348)=  0.309894582702212706D+08
      C(349)=  0.175067248639494985D+09
      C(350)=  0.531544228531821519D+08
      C(351)= -0.101508070493108481D+09
      C(352)= -0.138809936987558365D+09
      C(353)= -0.756371759056946486D+08
      C(354)= -0.239159017919550854D+06
      C(355)=  0.758572091009290218D+08
      C(356)= -0.906302728813334834D+06
      C(357)=  0.209139135526038399D+04
      C(358)= -0.194898004403473675D+09
      C(359)=  0.104779754494096383D+09
      C(360)=  0.155613416403043687D+09
      C(361)= -0.254562881634380817D+09
      C(362)= -0.545874705055054277D+08
      C(363)= -0.525810952752391156D+07
      C(364)= -0.513776806989356577D+08
      C(365)= -0.103854115627336368D+09
      C(366)=  0.173844118808950037D+08
      C(367)=  0.257452683541916519D+09
      C(368)= -0.160941523589171052D+09
      C(369)= -0.904585295022329665D+06
      C(370)=  0.557232834051621333D+08
      C(371)= -0.124754550563966413D+07
      C(372)=  0.262367141073879510D+09
      C(373)= -0.313431115416375405D+02
      C(374)= -0.252016324080120802D+09
      C(375)= -0.128171592253549471D+09
      C(376)= -0.145647865260627389D+09
      C(377)= -0.133262423647790402D+09
      C(378)= -0.154631344724482034D+00
      C(379)=  0.872985539990470558D+08
      C(380)=  0.263473065539835572D+09
      C(381)=  0.219174160845999867D+09
      C(382)=  0.271765044027515233D+09
      C(383)= -0.412567801399783015D+09
      C(384)= -0.543098069261015058D+09
      C(385)=  0.295617012359393500D+08
      C(386)=  0.560522393169209063D+08
      C(387)= -0.119271370910373144D+08
      C(388)=  0.102276399985316500D+09
      C(389)=  0.189149636837033182D+09
      C(390)=  0.589202450211664289D+08
      C(391)= -0.636684260378074124D+08
      C(392)=  0.112785810944169760D+09
      C(393)=  0.191322321804751568D+08
      C(394)= -0.827447816885721236D+08
      C(395)= -0.680053456737457309D+07
      C(396)= -0.203293093964415928D+07
      C(397)= -0.697415291504790187D+08
      C(398)= -0.139415509498597443D+09
      C(399)= -0.544735221539729312D+08
      C(400)=  0.253551927002947092D+09
      C(401)= -0.353851427073399842D+09
      C(402)=  0.450888193387679756D+09
      C(403)=  0.414691802057749033D+09
      C(404)=  0.344683624661482424D+08
      C(405)=  0.100880718967824340D+09
      C(406)= -0.184340419233662218D+09
      C(407)= -0.304667375464704037D+08
      C(408)=  0.197592697815884352D+09
      C(409)= -0.332269876197082460D+09
      C(410)=  0.148708032858467966D+09
      C(411)=  0.369283710519427836D+09
      C(412)=  0.151189874933755606D+09
      C(413)= -0.115383613186886025D+06
      C(414)= -0.137731828802842766D+09
      C(415)= -0.184865443299308708D+03
      C(416)=  0.103172575777985230D+08
      C(417)=  0.975399909062853158D+08
      C(418)=  0.264746480686026454D+09
      C(419)= -0.259932461081043810D+09
      C(420)= -0.885639479687149823D+08
      C(421)=  0.363147510430193841D+08
      C(422)=  0.126817185677753925D+09
      C(423)= -0.510163435198088609D+04
      C(424)= -0.667340406552204013D+09
      C(425)= -0.564450139277918786D+08
      C(426)= -0.455830877860542297D+09
      C(427)= -0.170043434399561942D+09
      C(428)= -0.767732878260688186D+08
      C(429)=  0.108733610810910329D+09
      C(430)=  0.371343610708439350D+08
      C(431)= -0.168553369879585892D+09
      C(432)=  0.480785222433780968D+09
      C(433)=  0.380843714128129244D+09
      C(434)=  0.163505642454762965D+09
      C(435)= -0.464583787840582252D+09
      C(436)= -0.223344128561521694D+08
      C(437)= -0.126549295857765496D+09
      C(438)=  0.224415195791764498D+09
      C(439)= -0.361180738317449629D+09
      C(440)= -0.159867928394387484D+09
      C(441)= -0.244395142787895977D+09
      C(442)= -0.176733907014004320D+09
      C(443)=  0.347954267905110419D+09
      C(444)=  0.729548032385139763D+08
      C(445)= -0.132044448496250272D+09
      C(446)= -0.101664891482720785D+08
      C(447)=  0.319046503327601194D+09
      C(448)=  0.253274818839847982D+09
      C(449)= -0.541578716269258261D+09
      C(450)= -0.397242725268816710D+09
      C(451)=  0.102971175967201829D+09
      C(452)= -0.448269167338930905D+09
      C(453)= -0.274118075098442912D+09
      C(454)= -0.219930325581451327D+09
      C(455)= -0.525512375783562243D+09
      C(456)= -0.561826198425127387D+09
      C(457)=  0.197736421511560827D+09
      C(458)= -0.103107333226767106D+01
      C(459)=  0.170874128622146964D+09
      C(460)=  0.131070455383041531D+09
      C(461)= -0.385987960670464993D+09
      C(462)=  0.386218900928325117D+09
      C(463)=  0.365985496005640090D+09
      C(464)= -0.585751831155496649D+06
      C(465)= -0.379636025104878604D+09
      C(466)=  0.433868608205206871D+09
      C(467)= -0.275170597268814027D+09
      C(468)= -0.340636891501707956D+08
      C(469)=  0.355965221080349445D+09
      C(470)=  0.469506228951948643D+09
      C(471)=  0.110287198305887341D+09
      C(472)= -0.174877302083864152D+09
      C(473)= -0.162606531361586094D+09
      C(474)=  0.106112306809511319D+09
      C(475)=  0.982287691051959157D+09
      C(476)= -0.241492405341778606D+09
      C(477)= -0.335843355455635667D+09
      C(478)= -0.798354559319236279D+09
      C(479)= -0.619977623993471861D+09
      C(480)= -0.734402653322786570D+09
      C(481)= -0.726458006682692766D+09
      C(482)= -0.532722147046656087D+08
      C(483)=  0.423217201609222963D+08
      C(484)=  0.820299090645987093D+08
      C(485)=  0.107954255328184295D+10
      C(486)=  0.405461879367607415D+09
      C(487)=  0.406083037851314306D+09
      C(488)=  0.119253277572059661D+09
      C(489)=  0.318114622228210270D+09
      C(490)=  0.781317937159617897D+06
      C(491)=  0.479923365173723642D+07
      C(492)=  0.327113665767753720D+09
      C(493)=  0.396089098352810323D+09
      C(494)=  0.500864736179708969D+07
      C(495)= -0.581158333819566727D+09
      C(496)= -0.473968549301478863D+09
      C(497)= -0.390429593525136530D+09
      C(498)=  0.562138532518208865D+07
      C(499)= -0.876334910154533863D+09
      C(500)=  0.430317970836516023D+09
      C(501)= -0.134398491073701084D+09
      C(502)=  0.766375019305797666D+07
      C(503)= -0.142553051520190030D+09
      C(504)=  0.228211199085313857D+09
      C(505)=  0.118776378011460099D+08
      C(506)= -0.437117119518903136D+09
      C(507)=  0.161514821328624415D+10
      C(508)= -0.119504690659863204D+09
      C(509)= -0.374646837731896937D+09
      C(510)=  0.136426656389880270D+09
      C(511)=  0.282883618674007714D+09
      C(512)= -0.672721843924823165D+09
      C(513)= -0.848169348835755885D+08
      C(514)=  0.857917520579238772D+09
      C(515)= -0.112110588066887960D+09
      C(516)= -0.170510699957159281D+09
      C(517)=  0.315824797850696206D+09
      C(518)=  0.526705052495776653D+09
      C(519)=  0.109755787667413926D+10
      C(520)=  0.234481909425346941D+09
      C(521)=  0.136981648223553038D+10
      C(522)=  0.425088248874861717D+09
      C(523)=  0.857035754703413010D+09
      C(524)= -0.893088360744966984D+09
      C(525)= -0.104124370768322647D+10
      C(526)= -0.740861325992428780D+09
      C(527)=  0.493505433196177304D+09
      C(528)= -0.527451199624193966D+09
      C(529)=  0.519267540552635193D+08
      C(530)=  0.321317702437673807D+09
      C(531)=  0.947426978938322216D+08
      C(532)=  0.706350896608492136D+09
      C(533)=  0.191246737329526782D+10
      C(534)= -0.297333102545530200D+09
      C(535)= -0.962339741861212850D+09
      C(536)= -0.141572668790918779D+10
      C(537)= -0.385400447775380104D+06
      C(538)= -0.191088384556865543D+09
      C(539)=  0.599000684868682742D+09
      C(540)= -0.402661252166199964D+06
      C(541)= -0.483464966256011307D+09
      C(542)= -0.467146374238409698D+09
      C(543)=  0.167556332489675307D+10
      C(544)= -0.776090337040742159D+09
      C(545)=  0.568368165286387563D+09
      C(546)=  0.988867236447566152D+09
      C(547)= -0.227492514211942144D+08
      C(548)= -0.142619190028003544D+09
      C(549)=  0.201474377923165530D+09
      C(550)= -0.108840370218646812D+10
      C(551)= -0.921227697939270735D+08
      C(552)=  0.809621539461791217D+08
      C(553)= -0.678213474138400197D+09
      C(554)= -0.461026319192961633D+09
      C(555)=  0.525238044709189951D+09
      C(556)=  0.848937081977301359D+09
      C(557)=  0.758803310161771894D+09
      C(558)=  0.995393172631168485D+09
      C(559)=  0.284000289772026360D+09
      C(560)=  0.987510842373637080D+09
      C(561)=  0.315029088409410743D+07
      C(562)= -0.139723850381990014D+05
      C(563)= -0.411835225411671877D+09
      C(564)= -0.247874804899713039D+10
      C(565)=  0.758255862800950766D+09
      C(566)= -0.154985624364118780D+04
      C(567)=  0.221885345511809206D+10
      C(568)= -0.451726153618574515D+08
      C(569)= -0.106553178704491246D+10
      C(570)=  0.125250912700743005D+09
      C(571)= -0.163326975703739977D+10
      C(572)= -0.295057475395786995D+07
      C(573)=  0.489609437947264731D+09
      C(574)= -0.104480353098022994D+08
      C(575)=  0.177438771495141602D+10
      C(576)= -0.145849339846289635D+09
      C(577)=  0.380004235404810369D+09
      C(578)= -0.604682094324273109D+09
      C(579)=  0.361723957230835687D+06
      C(580)=  0.269013417368267715D+09
      C(581)= -0.114863978995043182D+10
      C(582)= -0.206099535300812411D+10
      C(583)= -0.977790379838855863D+09
      C(584)=  0.948247786730784893D+09
      C(585)=  0.958624283868839383D+09
      C(586)= -0.189960158565461755D+10
      C(587)= -0.238306959102375269D+10
      C(588)= -0.190662103040271625D+07
      C(589)=  0.715093884045501351D+09
      C(590)= -0.907758548083255053D+09
      C(591)=  0.603500347737260103D+09
      C(592)= -0.120979148418599695D+09
      C(593)=  0.205595159336935310D+07
      C(594)= -0.637165084313310623D+09
      C(595)=  0.720166631656499654D+08
      C(596)=  0.946854984874647856D+09
      C(597)=  0.612400837568606138D+09
      C(598)= -0.967842768961844563D+09
      C(599)= -0.143831561495054245D+10
      C(600)=  0.603450072919735074D+09
      C(601)=  0.448742859583371699D+09
      C(602)=  0.653956867393401504D+09
      C(603)=  0.814079456386528257D+07
      C(604)=  0.983219302382661581D+09
      C(605)= -0.314196980145991035D+08
      C(606)=  0.144975621336531162D+10
      C(607)= -0.259648384901462615D+09
      C(608)=  0.674575721288320899D+09
      C(609)= -0.149574113360720277D+09
      C(610)= -0.688548109557763696D+09
      C(611)=  0.712572337045879245D+09
      C(612)=  0.334948610566188872D+09
      C(613)= -0.263535441608430535D+09
      C(614)= -0.205479517167684937D+10
      C(615)=  0.756075260572801977D+08
      C(616)= -0.212300244718800068D+09
      C(617)=  0.565522674724939913D+08
      C(618)=  0.657884970148748040D+09
      C(619)= -0.566556417862892151D+09
      C(620)=  0.532472936937214613D+09
      C(621)= -0.465405455029226720D+09
      C(622)= -0.979201460348189950D+09
      C(623)= -0.212391873842859358D+09
      C(624)= -0.643704229661016107D+09
      C(625)= -0.750291616825325727D+09
      C(626)=  0.434728043380463541D+09
      C(627)= -0.472989600266833156D+08
      C(628)=  0.333102312986664951D+09
      C(629)=  0.154501073146552825D+10
      C(630)=  0.125999477502544284D+10
      C(631)= -0.122269303449967170D+10
      C(632)= -0.250683096502883993D+08
      C(633)= -0.293808769735802412D+10
      C(634)=  0.169304292751091421D+09
      C(635)=  0.250179480480356026D+10
      C(636)=  0.240567264115661287D+10
      C(637)=  0.657276814463840961D+09
      C(638)=  0.348358281614016831D+09
      C(639)= -0.407903818482457777D+06
      C(640)= -0.150171981021067882D+10
      C(641)= -0.412451248421922827D+10
      C(642)=  0.134385809146550751D+10
      C(643)= -0.420813153842235744D+09
      C(644)=  0.196638962675836372D+10
      C(645)= -0.891762518555347919D+09
      C(646)= -0.151488087464771318D+10
      C(647)= -0.308849595098289251D+10
      C(648)= -0.206664099975099039D+10
      C(649)= -0.101950240622414780D+10
      C(650)=  0.273095601567285769D+08
      C(651)=  0.420532635495630836D+10
      C(652)=  0.851852657863470793D+09
      C(653)= -0.259241072845063972D+10
      C(654)= -0.619600581373873726D+07
      C(655)=  0.256860261243888903D+10
      C(656)=  0.287224630788667488D+10
      C(657)=  0.175009458145557594D+10
      C(658)=  0.142172180584420156D+10
      C(659)=  0.222832370677686024D+10
      C(660)= -0.903907280132698417D+08
      C(661)=  0.100448752910501206D+10
      C(662)= -0.424320992468694508D+09
      C(663)=  0.195746270238362312D+10
      C(664)= -0.973970959846331596D+09
      C(665)= -0.680808028501452565D+09
      C(666)= -0.763340181374518633D+09
      C(667)= -0.289915319310639381D+09
      C(668)= -0.143898512211139417D+10
      C(669)= -0.110689332587893128D+10
      C(670)= -0.399939552496202171D+09
      C(671)= -0.751663164418962121D+09
      C(672)= -0.106776659807155013D+10
      C(673)= -0.980970701208772540D+09
      C(674)= -0.839660710905282378D+09
      C(675)=  0.285053565201601088D+09
      C(676)=  0.342607832743341625D+09
      C(677)= -0.468571637780271471D+09
      C(678)= -0.849974629520948052D+09
      C(679)=  0.124540587484237885D+10
      C(680)=  0.632927925207293510D+09
      C(681)=  0.381702479254240468D+08
      C(682)=  0.771554924440482855D+09
      C(683)=  0.573601472353042006D+09
      C(684)=  0.126274255377684264D+01
      C(685)= -0.164488228186675123D+01
      C(686)= -0.299903954629339518D-03
      C(687)=  0.232123854751777881D+01
      C(688)=  0.164711667732665629D+00
      C(689)= -0.142831935721023329D+01
      C(690)=  0.468722062016370677D-01
      C(691)=  0.624098340914674005D-01
      C(692)=  0.155882250676297601D+00
      C(693)= -0.997325635887207864D+04
      C(694)=  0.719928154703061707D+00
      C(695)=  0.915674932908943973D+00
      C(696)=  0.319158044948354203D+01
      C(697)=  0.713873621644589340D+00
      C(698)=  0.470961194131425509D+00
      C(699)=  0.699656896417086505D+00
      C(700)=  0.193122229129305234D+01
      C(701)=  0.155841904041989898D+01
      C(702)=  0.104013960809273964D+01
      C(703)=  0.414000505937959229D+00
      C(704)=  0.115902093262765749D+01
      C(705)=  0.129776430835251499D+01

      BSORDER(1)=10

      POLORDER=26

      DO I=1,DEG
        NCBAS(I)=0.0D+00
        NCBAS(I)=2*BSORDER(I)+2
      END DO

      CALL POLNC(POLORDER,MOLTYP,NCPOL)

      IF (NC.NE.(NCPOL+SUM(NCBAS))) THEN 
        WRITE(*,*) "PROBLEMS IN DEFINING PROPER NUMBER OF COEFFICIENTS"
        WRITE(*,*) "TOTAL NUMBER OF COEFFS ARE NOT SUMMING UP CORRECTLY"
        STOP
      END IF

      ALLOCATE(POL(NCPOL))
      ALLOCATE(DVDY1(NCPOL),DVDY2(NCPOL),DVDY3(NCPOL))

      DO I=1,NCPOL
        POL(I)=0.00D+00
        DVDY1(I)=0.00D+00
        DVDY2(I)=0.00D+00
        DVDY3(I)=0.00D+00
      END DO

      DO I=1,NX
        Y(I)=0.0D+00
        DYDR(I)=0.0D+00
        DVDR(I)=0.0D+00
      END DO

      SUMC=NCPOL
      DO I=1,DEG
        ALLOCATE(BS(NCBAS(I)))
        DO J=1,NCBAS(I)
          BS(J)=0.0D+00
        END DO
        K=SUMC
        DO J=1,NCBAS(I)
          K=K+1
          BS(J)=C(K)
        END DO

        IF (DEG.EQ.1) THEN
          DO O=1,3 
            CALL BASIS_CONTRACT(1,BSORDER(1),BS,R(O),Y(O))

!###### CALCULATING ANALYTIC DERIVATIVES OF Y WITH RESPECT TO R IF DER=.TRUE.
            
            IF (DER) THEN
              CALL DBASIS_CONTRACT(1,BSORDER(1),BS,R(O),DYDR(O))
            END IF

!######

          END DO
        END IF

        SUMC=SUMC+NCBAS(I)
        DEALLOCATE(BS)
      END DO

      TOTNUM=0
      S=0
      DO M=0,POLORDER
        MNUM=0
        DO I=0,M
          DO J=0,(M-I)
            K=M-I-J
            S=I+J+K
            IF (S.NE.I .AND. S.NE.J .AND. S.NE.K) THEN

              IF (MOLTYP.EQ."ABC") THEN  

                TOTNUM=TOTNUM+1
                MNUM=MNUM+1

                CALL PERMUTABC(I,J,K,P,ID)

                DO L=1,ID

                  POL(TOTNUM)=POL(TOTNUM)+&
     &               (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

                END DO

                POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

              ELSE IF (MOLTYP.EQ."AB2") THEN 

                IF (J.LE.K) THEN 

                  TOTNUM=TOTNUM+1
                  MNUM=MNUM+1

                  CALL PERMUTAB2(I,J,K,P,ID)
                   
                  DO L=1,ID

                    POL(TOTNUM)=POL(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

                  END DO

                  POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

                END IF    
         
              ELSE IF (MOLTYP.EQ."A3") THEN

                IF (I.LE.J .AND. J.LE.K) THEN

                  TOTNUM=TOTNUM+1
                  MNUM=MNUM+1

                  CALL PERMUTA3(I,J,K,P,ID)
                   
                  DO L=1,ID

                    POL(TOTNUM)=POL(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO Y IF DER=.TRUE.

                      IF (DER) THEN
             
                        DVDY1(TOTNUM)=DVDY1(TOTNUM)+&
     &                 (P(1,L)*Y(1)**(P(1,L)-1)*Y(2)**(P(2,L))*Y(3)**(P(3,L))) 

                        DVDY2(TOTNUM)=DVDY2(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*P(2,L)*Y(2)**(P(2,L)-1)*Y(3)**(P(3,L)))    

                        DVDY3(TOTNUM)=DVDY3(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*P(3,L)*Y(3)**(P(3,L)-1)) 
             
                      END IF

!######

                  END DO

                  POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

!###### MULTIPLYING THE CONTRIBUTIONS OF DVDY BY THE POLYNOMIAL COEFFS. IF DER=.TRUE.

                  IF (DER) THEN
                    DVDY1(TOTNUM)=C(TOTNUM)*DVDY1(TOTNUM)/DBLE(ID)
                    DVDY2(TOTNUM)=C(TOTNUM)*DVDY2(TOTNUM)/DBLE(ID)
                    DVDY3(TOTNUM)=C(TOTNUM)*DVDY3(TOTNUM)/DBLE(ID)
                  END IF

!######

                END IF

              END IF

            END IF
          END DO
        END DO

      END DO

      POT=SUM(POL)*REPDAMP(NX,R)

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO R IF DER=.TRUE.

      IF (DER) THEN
        DVDR(1)=SUM(DVDY1)*DYDR(1)
        DVDR(2)=SUM(DVDY2)*DYDR(2)
        DVDR(3)=SUM(DVDY3)*DYDR(3)
      ELSE 
        DVDR(1)=1000
        DVDR(2)=1000
        DVDR(3)=1000
      END IF

!######

      DEALLOCATE(POL)
      DEALLOCATE(DVDY1,DVDY2,DVDY3)

      RETURN
      END

!###################################################################################################### 

      DOUBLE PRECISION FUNCTION REPDAMP(NX,R)
      INTEGER :: I
      DOUBLE PRECISION, DIMENSION(NX) :: R,H
      DOUBLE PRECISION :: KAPPA, XI, R0
      R0=0.5D+00
      KAPPA=100.0D+00
      XI=10.0D+00
      DO I=1,NX
        H(I)=0.5D+00*(1.00D+00+TANH(KAPPA*(R(I)-R0)))
      END DO
      REPDAMP=(PRODUCT(H))**(XI)      
      END FUNCTION

!######################################################################################################      
      
      SUBROUTINE PERMUTABC(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO

      INTER(1)=I
      INTER(2)=J
      INTER(3)=K

      ID=1

      P(1,1)=INTER(1)
      P(2,1)=INTER(2)
      P(3,1)=INTER(3) 

      RETURN
      END

!######################################################################################################      
      
      SUBROUTINE PERMUTAB2(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO
      
      INTER(1)=I
      INTER(2)=J
      INTER(3)=K
      
      IF (J.NE.K) THEN  
 
        ID=2

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(1)
        P(2,2)=INTER(3)
        P(3,2)=INTER(2) 

       ELSE 

        ID=1

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)

       END IF

      RETURN 
      END 

!#######################################################################################################      
      
      SUBROUTINE PERMUTA3(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO
      
      INTER(1)=I
      INTER(2)=J
      INTER(3)=K
      
      IF (I.EQ.J.AND.J.EQ.K.AND.I.EQ.K) THEN
      
        ID=1

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)  
        
      ELSE IF (I.NE.J.AND.J.NE.K.AND.I.NE.K) THEN   

        ID=6

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(3)
        P(2,3)=INTER(2)
        P(3,3)=INTER(1) 

        P(1,4)=INTER(1)
        P(2,4)=INTER(3)
        P(3,4)=INTER(2) 

        P(1,5)=P(1,2)
        P(2,5)=P(3,2)
        P(3,5)=P(2,2)  

        P(1,6)=P(1,3)
        P(2,6)=P(3,3)
        P(3,6)=P(2,3)  
        
      ELSE IF (I.EQ.J) THEN       
     
        ID=3     

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3) 

        P(1,2)=INTER(3)
        P(2,2)=INTER(2)
        P(3,2)=INTER(1) 

        P(1,3)=INTER(1)
        P(2,3)=INTER(3)
        P(3,3)=INTER(2)
        
      ELSE IF (J.EQ.K) THEN       
                    
        ID=3     

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(3)
        P(2,3)=INTER(2)
        P(3,3)=INTER(1) 
        
      ELSE IF (I.EQ.K) THEN    
  
        ID=3  

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(1)
        P(2,3)=INTER(3)
        P(3,3)=INTER(2)        
    
      END IF

      RETURN 
      END 

!###################################################################################################### 

      SUBROUTINE POLNC(ORDER,MOLTYP,NC)
      IMPLICIT NONE
      INTEGER :: I,J,K,L,M,S
      INTEGER :: NC,MNUM,ORDER
      CHARACTER(LEN=3) :: MOLTYP

      NC=0
      S=0

      DO M=0,ORDER
        MNUM=0
        DO I=0,M
          DO J=0,(M-I)
            K=M-I-J
            S=I+J+K
            IF (S.NE.I .AND. S.NE.J .AND. S.NE.K) THEN
 
              IF (MOLTYP.EQ."ABC") THEN  

                NC=NC+1
                MNUM=MNUM+1

              ELSE IF (MOLTYP.EQ."AB2") THEN 

                IF (J.LE.K) THEN 

                  NC=NC+1
                  MNUM=MNUM+1

                END IF    
        
              ELSE IF (MOLTYP.EQ."A3") THEN

                IF (I.LE.J .AND. J.LE.K) THEN

                  NC=NC+1
                  MNUM=MNUM+1

                END IF

              END IF

            END IF
          END DO
        END DO
      END DO

      RETURN
      END

!######################################################################################################

      SUBROUTINE SUM2BD(R1,R2,R3,SUMV2)
      IMPLICIT NONE
      INTEGER :: I
      DOUBLE PRECISION :: R1,R2,R3,SUMV2
      DOUBLE PRECISION, DIMENSION(3) :: V1,V2,VTOT
      DOUBLE PRECISION, DIMENSION(3) :: RE
      DOUBLE PRECISION, DIMENSION(3) :: RJAC
      DOUBLE PRECISION, DIMENSION(3) :: RB,RC
      DOUBLE PRECISION, DIMENSION(3) :: COSGAMMA
      DOUBLE PRECISION :: DIAT1,DIAT2,DIAT3
      DOUBLE PRECISION :: X0,GAM,RANG2BD
      LOGICAL :: DER
      DOUBLE PRECISION :: DVDR1,DVDR2,DVDR3

      DER=.FALSE.

      V1(1)=DIAT1(R1)
      V1(2)=DIAT2(R2)
      V1(3)=DIAT3(R3)
      CALL CHIPR_C2SIGPS(R1,V2(1),DER,DVDR1)
      CALL CHIPR_C2SIGPS(R2,V2(2),DER,DVDR2)
      CALL CHIPR_C2SIGPS(R3,V2(3),DER,DVDR3)
      CALL TRIANG2JACOBI(R1,R2,R3,RE,RJAC,COSGAMMA,RB,RC)
      X0=5.0D+00
      GAM=1.0D+00
      DO I=1,3
        VTOT(I)=(V2(I)+(V1(I)-V2(I))*RANG2BD(RJAC(I),X0,GAM))
      END DO
      SUMV2=SUM(VTOT)
      RETURN 
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION DIAT1(R1)
      IMPLICIT NONE
      DOUBLE PRECISION :: R1,V21

      CALL TWOBD(R1,V21)

      DIAT1=V21

      RETURN 
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION DIAT2(R2)
      IMPLICIT NONE
      DOUBLE PRECISION :: R2,V22

      CALL TWOBD(R2,V22)

      DIAT2=V22

      RETURN 
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION DIAT3(R3)
      IMPLICIT NONE
      DOUBLE PRECISION :: R3,V23

      CALL TWOBD(R3,V23)

      DIAT3=V23

      RETURN 
      END

!######################################################################################################
! RANG FUNCTION THAT CHANGES ONE DIATOMIC TO THE OTHER
!######################################################################################################

      DOUBLE PRECISION FUNCTION RANG2BD(R,X0,GAM)
      IMPLICIT NONE
      DOUBLE PRECISION :: R,X0,GAM
      RANG2BD=0.50D+00*(1.00D+00+TANH(GAM*(R-X0)))
      END FUNCTION RANG2BD

!######################################################################################################
! CONVERTING TRIANGULAR TO JACOBI COORDINATES
!######################################################################################################

      SUBROUTINE TRIANG2JACOBI(R1,R2,R3,RE,RJAC,COSGAMMA,RB,RC)
      IMPLICIT NONE
      DOUBLE PRECISION :: R1,R2,R3
      DOUBLE PRECISION, DIMENSION(3) :: RE
      DOUBLE PRECISION, DIMENSION(3) :: RJAC
      DOUBLE PRECISION, DIMENSION(3) :: RB,RC
      DOUBLE PRECISION, DIMENSION(3) :: SQUAREDRJAC
      DOUBLE PRECISION, DIMENSION(3) :: COSGAMMA
      DOUBLE PRECISION :: PI,ZERO
      INTEGER :: I

      PI=4.0D0*DATAN(1.0D+00)
      ZERO=1.0D-12

      DO I=1,3

        IF (I==1) THEN          !! CHANNEL 1 
 
          RE(I)=R1
          RB(I)=R2
          RC(I)=R3

        ELSE IF (I==2) THEN     !! CHANNEL 2

          RE(I)=R2
          RB(I)=R3
          RC(I)=R1

        ELSE IF (I==3) THEN     !! CHANNEL 3

          RE(I)=R3
          RB(I)=R1
          RC(I)=R2

        END IF

        RJAC(I)=ZERO

        SQUAREDRJAC(I)=0.5D+00*(RB(I)**2+RC(I)**2-0.5D+00*RE(I)**2)

          IF (SQUAREDRJAC(I) > 0) THEN 

            RJAC(I)=SQRT(SQUAREDRJAC(I)) 

          END IF
    
        COSGAMMA(I)=(0.5D+00*(RC(I)**2-RB(I)**2))/(RJAC(I)*RE(I))

          IF (COSGAMMA(I)>1.0D+00) THEN 

            COSGAMMA(I)=1.0D+00 

          ELSE IF (COSGAMMA(I)<-1.0D+00) THEN 
   
            COSGAMMA(I)=-1.0D+00

          END IF 

      END DO

      END SUBROUTINE TRIANG2JACOBI

!######################################################################################################
! TOTAL TWO-BODY POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE TWOBD(R,POT)
      IMPLICIT NONE
      INTEGER :: I,J 
      INTEGER, PARAMETER :: M=1
      DOUBLE PRECISION, DIMENSION(6*M+3) :: C
      DOUBLE PRECISION, DIMENSION(3,3) :: H,VEC
      DOUBLE PRECISION, DIMENSION(3) :: EIGVAL
      DOUBLE PRECISION :: R,POT,SECH
      DOUBLE PRECISION :: POT1,POT2,POT3
      DOUBLE PRECISION :: RC12,RC23,RC13,RHO
      LOGICAL :: DER
      DOUBLE PRECISION :: DVDR1,DVDR2,DVDR3

      RHO=1.0D-08

      C(1)=-0.491457630094914899D-07
      C(2)= 0.157491862773895264D+00
      C(3)= 0.543041520945708385D-04
      C(4)= 0.634928047657012939D+00
      C(5)=-0.140642678423768619D-02
      C(6)= 0.157993710041046143D+01

      C(6*M+1)=2.4474817237408617D+00
      C(6*M+2)=3.1694695847347925D+00
      C(6*M+3)=2.6955705977852991D+00

      DO I=1,3
        DO J=1,3
          H(I,J)=0.0D+00
        END DO
      END DO 

      DER=.FALSE.

      CALL CHIPR_C2SIGPS(R,POT1,DER,DVDR1)
      CALL CHIPR_C2PIUT(R,POT2,DER,DVDR2)
      CALL CHIPR_C2SIGMT(R,POT3,DER,DVDR3)

      H(1,1)=POT1
      H(2,2)=POT2
      H(3,3)=POT3

      RC12=C(6*M+1)
      RC23=C(6*M+2)
      RC13=C(6*M+3)

      DO I=1,M
        H(1,2)=H(1,2)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC12))
      END DO

      H(2,1)=H(1,2)

      DO I=2*M+1,3*M
        H(2,3)=H(2,3)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC23))
      END DO

      H(3,2)=H(2,3)

      DO I=4*M+1,5*M
        H(1,3)=H(1,3)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC13))
      END DO

      H(3,1)=H(1,3)

      CALL TBDDIAG(H,EIGVAL,VEC,3,RHO)

      POT=EIGVAL(1)

      RETURN
      END

!######################################################################################################
! TOTAL TWO-BODY POTENTIAL ENERGY CURVE WITH EXPERIMENTALLY-DETERMINED DIABATS
!######################################################################################################

      SUBROUTINE TWOBD_EXP(R,POT)
      IMPLICIT NONE
      INTEGER :: I,J 
      INTEGER, PARAMETER :: M=1
      DOUBLE PRECISION, DIMENSION(6*M+3) :: C
      DOUBLE PRECISION, DIMENSION(3,3) :: H,VEC
      DOUBLE PRECISION, DIMENSION(3) :: EIGVAL
      DOUBLE PRECISION :: R,POT,SECH
      DOUBLE PRECISION :: POT1,POT2,POT3
      DOUBLE PRECISION :: RC12,RC23,RC13,RHO
      LOGICAL :: DER
      DOUBLE PRECISION :: DVDR1,DVDR2,DVDR3

      RHO=1.0D-08

      C(1)= 0.491457630094914899D-07
      C(2)= 0.257491862773895264D+00
      C(3)= 0.543041520945708385D-04
      C(4)= 0.634928047657012939D+00
      C(5)= 0.140642678423768619D-02
      C(6)= 0.157993710041046143D+01

      C(6*M+1)=2.4474817237408617D+00
      C(6*M+2)=3.1694695847347925D+00
      C(6*M+3)=2.6955705977852991D+00
 
      DO I=1,3
        DO J=1,3
          H(I,J)=0.0D+00
        END DO
      END DO 

      DER=.FALSE.

      CALL CHIPR_C2SIGPS_EXP(R,POT1,DER,DVDR1)
      CALL CHIPR_C2PIUT_EXP(R,POT2,DER,DVDR2)
      CALL CHIPR_C2SIGMT_EXP(R,POT3,DER,DVDR3)

      H(1,1)=POT1
      H(2,2)=POT2
      H(3,3)=POT3

      RC12=C(6*M+1)
      RC23=C(6*M+2)
      RC13=C(6*M+3)

      DO I=1,M
        H(1,2)=H(1,2)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC12))
      END DO

      H(2,1)=H(1,2)

      DO I=2*M+1,3*M
        H(2,3)=H(2,3)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC23))
      END DO

      H(3,2)=H(2,3)

      DO I=4*M+1,5*M
        H(1,3)=H(1,3)+&
     &  0.5D+00*C(I)*C(I+M)*SECH(C(I+M)*(R-RC13))
      END DO

      H(3,1)=H(1,3)

      CALL TBDDIAG(H,EIGVAL,VEC,3,RHO)
      
      POT=EIGVAL(1)

      RETURN
      END      

!######################################################################################################

      SUBROUTINE TBDDIAG(A,EIG,VEC,NN,RHO)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NDIM=3
      INTEGER :: I,I1,J,N,NR,NN,N1,N2,NPAS,NT 
      INTEGER :: ITEMP,LV,NRR,K,L,M,NP,NV,QJ  
      DOUBLE PRECISION :: EIG(NDIM)
      DOUBLE PRECISION :: W(NDIM),BETASQ(NDIM)
      DOUBLE PRECISION :: GAMMA(NDIM),BETA(NDIM)
      DOUBLE PRECISION :: A(NDIM,NDIM),VEC(NDIM,NDIM)
      DOUBLE PRECISION :: P(NDIM),Q(NDIM),IPOSV(NDIM)
      DOUBLE PRECISION :: IVPOS(NDIM),IORD(NDIM)
      DOUBLE PRECISION :: RHOSQ,RHO,SHIFT,S,SGN,D,TEMP,B
      DOUBLE PRECISION :: SQRTS,WTAW,SUM,COSA,G,PP,PPBS,PPBR
      DOUBLE PRECISION :: COSAP,SINA,SINA2,DIA,U,A2,R2,R1,R12
      DOUBLE PRECISION :: DIF,WJ
      RHOSQ=RHO*RHO
      N=NN
      IF (N.EQ.0) RETURN
      SHIFT = 0.0D0
      N1=N-1
      N2=N-2
      GAMMA(1)=A(1,1)
      IF (N2.NE.0) THEN 
         IF (N2.LT.0) GOTO 280
         DO 260 NR=1,N2
            B=A(NR+1,NR)
            S=0.0D0
            DO 130 I=NR,N2
               S=S+A(I+2,NR)**2
  130       CONTINUE
!
!         PREPARE FOR POSSIBLE BYPASS OF TRANSFORMATION
!
            A(NR+1,NR)=0.0D0
            IF (S.GT.0) THEN
               S=S+B*B
               SGN=+1.0D0
               IF (B.LT.0) SGN = -1.D0
               SQRTS=DSQRT(S)
               D=SGN/(SQRTS+SQRTS)
               TEMP=DSQRT(0.5D0+B*D)
               W(NR)=TEMP
               A(NR+1,NR)=TEMP
               D=D/TEMP
               B=-SGN*SQRTS
!
!         D IS FACTOR OF PROPORTIONALITY. COMPUTE AND SAVE W VECTOR
!
               DO 170 I=NR,N2
                  TEMP=D*A(I+2,NR)
                  W(I+1)=TEMP
                  A(I+2,NR)=TEMP
  170          CONTINUE
!
!         PREMULTIPLY VECTOR W BY MATRIX A TO OBTAIN P VECTOR.
!         SIMULTANEOUSLY ACCUMULATE DOT PRODUCT WP,(THE SCALAR K).
!
               WTAW = 0.0D0
               DO 210 I=NR,N1
                  SUM = 0.0D0
                  DO 180 J=NR,I
                     SUM=SUM+A(I+1,J+1)*W(J)
  180             CONTINUE
                  I1=I+1
                  IF ((N1-I1).GE.0) THEN
                     DO 200 J=I1,N1
                        SUM=SUM+A(J+1,I+1)*W(J)
  200                CONTINUE
                  ENDIF
                  P(I)=SUM
                  WTAW=WTAW+SUM*W(I)
  210          CONTINUE
!
!         P VECTOR AND SCALAR K NOW STORED. NEXT COMPUTE Q VECTOR
!         AND FORM PAP MATRIX.
!
               DO 220 I=NR,N1
                  Q(I)=P(I)-WTAW*W(I)
  220          CONTINUE
               DO 240 J=NR,N1
                  QJ=Q(J)
                  WJ=W(J)
                  DO 230 I=J,N1
                     A(I+1,J+1)=A(I+1,J+1)-2.*(W(I)*QJ+WJ*Q(I))
  230             CONTINUE
  240          CONTINUE
  250          BETA(NR)=B
            ENDIF
            BETASQ(NR)=B*B
            GAMMA(NR+1)=A(NR+1,NR+1)
  260    CONTINUE
      ENDIF
      B=A(N,N-1)
      BETA(N-1)=B
      BETASQ(N-1)=B*B
      GAMMA(N)=A(N,N)
  280 BETASQ(N)=0.
!
!         ADJOIN AN IDENTITY MATRIX TO BE POSTMULTIPLIED BY ROTATIONS
!
      DO 300 I=1,N
         DO 290 J=1,N
            VEC(I,J)=0.0D0
  290    CONTINUE
         VEC(I,I)=1.0D0
  300 CONTINUE
      M=N
      SUM=0.0D0
      NPAS=1
      GOTO 400
  310 SUM=SUM+SHIFT
      COSA=1.
      G=GAMMA(1)-SHIFT
      PP=G
      PPBS=PP*PP+BETASQ(1)
      PPBR=DSQRT(PPBS)
      DO 330 J=1,M
         COSAP=COSA
         IF (PPBS.EQ.0) THEN
            SINA = 0.0D0
            SINA2=0.0D0
            COSA=1.0D0
         ELSE
            SINA=BETA(J)/PPBR
            SINA2=BETASQ(J)/PPBS
            COSA=PP/PPBR
!
!         POSTMULTIPLY IDENTITY BY P-TRANSPOSE
!
            NT=J+NPAS
            IF (NT.GT.N) NT=N
            DO 320 I=1,NT
               TEMP=COSA*VEC(J,I)+SINA*VEC(J+1,I)
               VEC(J+1,I)=-SINA*VEC(J,I)+COSA*VEC(J+1,I)
               VEC(J,I)=TEMP
  320       CONTINUE
         ENDIF
         DIA=GAMMA(J+1)-SHIFT
         U=SINA2*(G+DIA)
         GAMMA(J)=G+U
         G=DIA-U
         PP=DIA*COSA-SINA*COSAP*BETA(J)
         IF (J.EQ.M) THEN
            BETA(J)=SINA*PP
            BETASQ(J)=SINA2*PP*PP
            GOTO 340
         ENDIF
         PPBS=PP*PP+BETASQ(J+1)
         PPBR=DSQRT(PPBS)
         BETA(J)=SINA*PPBR
         BETASQ(J)=SINA2*PPBS
  330 CONTINUE
  340 GAMMA(M+1)=G
!
!         TEST FOR CONVERGENCE OF LAST DIAGONAL ELEMENT
!
      NPAS=NPAS+1
      IF (BETASQ(M).GT.RHOSQ) GOTO 410
  390 EIG(M+1)=GAMMA(M+1)+SUM
  400 BETA(M)=0.0D0
      BETASQ(M)=0.0D0
      M=M-1
      IF (M.EQ.0) GOTO 430
      IF (BETASQ(M).LE.RHOSQ) GOTO 390
  410 CONTINUE 
!
!         TAKE ROOT OF CORNER 2 BY 2 NEAREST TO LOWER DIAGONAL IN
!         VALUE AS ESTIMATE OF EIGENVALUE TO USE FOR SHIFT
!
      A2=GAMMA(M+1)
      R2=0.5D0*A2
      R1=0.5D0*GAMMA(M)
      R12=R1+R2
      DIF=R1-R2
      TEMP=DSQRT(DIF*DIF+BETASQ(M))
      R1=R12+TEMP
      R2=R12-TEMP
      DIF=DABS(A2-R1)-DABS(A2-R2)
      IF (DIF.GE.0) THEN
         SHIFT=R2
      ELSE
         SHIFT=R1
      ENDIF
      GOTO 310
  430 EIG(1)=GAMMA(1)+SUM
!
!         INITIALIZE AUXILIARY TABLES REQUIRED FOR
!         REARANGING THE VECTORS
!
      DO 440 J=1,N
         IPOSV(J)=J
         IVPOS(J)=J
         IORD(J) = J
  440 CONTINUE
!
!         USE A TRANSPOSITON SORT TO ORDER THE EIGENVALUES
!
      M=N
      GOTO 470
  450 DO 460 J=1,M
         IF (EIG(J).GT.EIG(J+1)) THEN
            TEMP=EIG(J)
            EIG(J)=EIG(J+1)
            EIG(J+1)=TEMP
            ITEMP=IORD(J)
            IORD(J)=IORD(J+1)
            IORD(J+1)=ITEMP
         ENDIF
  460 CONTINUE
  470 M=M-1
      IF (M.NE.0) GOTO 450
      IF (N1.NE.0) THEN
         DO 490 L=1,N1
            NV=IORD(L)
            NP=IPOSV(NV)
            IF (NP.NE.L) THEN
               LV=IVPOS(L)
               IVPOS(NP)=LV
               IPOSV(LV)=NP
               DO 480 I=1,N
                  TEMP=VEC(L,I)
                  VEC(L,I)=VEC(NP,I)
                  VEC(NP,I) = TEMP
  480          CONTINUE
            ENDIF
  490    CONTINUE
      ENDIF
!
!         BACK TRANSFORM THE VECTORS OF THE TRIPLE DIAGONAL MATRIX
!
      DO 550 NRR=1,N
         K=N1
  510    K=K-1
         IF (K.GT.0) THEN
            SUM = 0.0
            DO 520 I=K,N1
               SUM=SUM+VEC(NRR,I+1)*A(I+1,K)
  520       CONTINUE
            SUM=SUM+SUM
            DO 530 I=K,N1
               VEC(NRR,I+1)=VEC(NRR,I+1)-SUM*A(I+1,K)
  530       CONTINUE
            GOTO 510
         ENDIF
  550 CONTINUE
      RETURN
      END 

!######################################################################################################
! C2 SIGMA G PLUS SINGLET POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2SIGPS(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=18
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)=-0.156080848440132039D-02
      C( 2)=-0.146090727319725361D+00
      C( 3)= 0.289447560018073835D+01
      C( 4)=-0.329128960443330456D+02
      C( 5)= 0.149172064999103469D+03
      C( 6)=-0.310764847510739344D+03
      C( 7)= 0.267631937984524939D+03
      C( 8)=-0.414922464726189091D+02
      C( 9)= 0.741626089532241739D+00
      C(10)=-0.176756629350128786D+00
      C(11)=-0.724212331201012048D-02
      C(12)=-0.225044902042792103D+03
      C(13)= 0.548451216510895345D+00
      C(14)= 0.935246919782962038D+00
      C(15)= 0.615983736625717704D+00
      C(16)= 0.412112345538274116D+01
      C(17)= 0.146596049324467104D+01
      C(18)= 0.946493553516430497D+00

      BSORDER=4

      POLORDER=8

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!######

      DEALLOCATE(BS)

      RETURN
      END  

!######################################################################################################
! C2 PI U TRIPLET POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2PIUT(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=16
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)= 0.688368821899691119D-01
      C( 2)= 0.342351245803137610D-01
      C( 3)= 0.154614262783052108D-01
      C( 4)= 0.869956989359632789D-02
      C( 5)= 0.805774584332814674D-02
      C( 6)=-0.155565331355019400D-02
      C( 7)= 0.140576516199323032D+01
      C( 8)=-0.651695535962590333D+00
      C( 9)= 0.415028815178197785D-01
      C(10)=-0.580664867995453619D+03
      C(11)= 0.131877461311567812D+01
      C(12)= 0.950567375315507390D+00
      C(13)= 0.108834374997582084D+01
      C(14)= 0.765033716358887284D+00
      C(15)= 0.240379211673489301D+01
      C(16)= 0.799892875462521968D+00

      BSORDER=4

      POLORDER=6

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!######

      DEALLOCATE(BS)

      RETURN
      END 

!######################################################################################################
! C2 SIGMA G MINUS TRIPLET POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2SIGMT(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=20
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)=-0.139383051089885024D+00
      C( 2)= 0.379894280261107440D+02
      C( 3)=-0.868777870230472763D+04
      C( 4)= 0.617478594715823303D+06
      C( 5)=-0.224837692867042422D+08
      C( 6)= 0.442548539070751369D+09
      C( 7)=-0.431210636544939327D+10
      C( 8)= 0.148558838775511398D+11
      C( 9)=-0.317605248014272630D+09
      C(10)= 0.374148111458616577D+12
      C(11)= 0.266819262786576694D+00
      C(12)=-0.210741782847390147D+00
      C(13)= 0.101634586991167734D-01
      C(14)=-0.393424499706291385D+03
      C(15)= 0.298588226648417887D+00
      C(16)= 0.299430688776365861D+00
      C(17)= 0.799635468897632928D+00
      C(18)= 0.439191465042685469D+00
      C(19)= 0.158695418480965822D+01
      C(20)= 0.138708213744285547D+01

      BSORDER=4

      POLORDER=10

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!######

      DEALLOCATE(BS)

      RETURN
      END 

!######################################################################################################
! C2 SIGMA G PLUS SINGLET EXPERIMENTALLY-DETERMINED POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2SIGPS_EXP(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=18
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)=-0.267086505870802468D-02
      C( 2)=-0.285280637765205680D+00
      C( 3)= 0.592287240803180115D+01
      C( 4)=-0.558544049425728630D+02
      C( 5)= 0.235039555064813953D+03
      C( 6)=-0.483801598735906566D+03
      C( 7)= 0.448105577174231883D+03
      C( 8)=-0.118126253532500471D+03
      C( 9)= 0.741626089532241739D+00
      C(10)=-0.177582090569614409D+00
      C(11)=-0.603744429598234399D-02
      C(12)=-0.225044902042792103D+03
      C(13)= 0.548451216510895345D+00
      C(14)= 0.935246919782962038D+00
      C(15)= 0.615983736625717704D+00
      C(16)= 0.412112345538274116D+01
      C(17)= 0.146596049324467104D+01
      C(18)= 0.946493553516430497D+00

      BSORDER=4

      POLORDER=8

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!######

      DEALLOCATE(BS)

      RETURN
      END  

!######################################################################################################
! C2 PI U TRIPLET EXPERIMENTALLY-DETERMINED POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2PIUT_EXP(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=16
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)= 0.673199875363553191D-01
      C( 2)= 0.354670818253029277D-01
      C( 3)= 0.454530262577290817D-01
      C( 4)= 0.896638948685439183D-02
      C( 5)=-0.557192541182933640D-01
      C( 6)= 0.396468034787315002D-01
      C( 7)= 0.137634242346898183D+01
      C( 8)=-0.644084104783897993D+00
      C( 9)= 0.415028815178197785D-01
      C(10)=-0.580664867995453619D+03
      C(11)= 0.132718504668728920D+01
      C(12)= 0.941815085429398735D+00
      C(13)= 0.108834374997582084D+01
      C(14)= 0.765033716358887284D+00
      C(15)= 0.240379211673489301D+01
      C(16)= 0.799892875462521968D+00

      BSORDER=4

      POLORDER=6

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!######

      DEALLOCATE(BS)

      RETURN
      END 

!######################################################################################################
! C2 SIGMA G MINUS TRIPLET EXPERIMENTALLY-DETERMINED POTENTIAL ENERGY CURVE
!######################################################################################################

      SUBROUTINE CHIPR_C2SIGMT_EXP(R,POT,DER,DVDR)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NC=20
      INTEGER :: I,J
      INTEGER :: BSORDER
      INTEGER :: POLORDER
      INTEGER :: NCBAS,NCPOL
      DOUBLE PRECISION, DIMENSION(2) :: Z
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: BS
      DOUBLE PRECISION :: Y   
      DOUBLE PRECISION :: R,POT
      LOGICAL :: DER
      DOUBLE PRECISION :: DYDR
      DOUBLE PRECISION :: DVDRPART1
      DOUBLE PRECISION :: DVDRPART2
      DOUBLE PRECISION :: DVDR

      Z( 1)= 0.600000000000000000D+01
      Z( 2)= 0.600000000000000000D+01

      C( 1)=-0.141127754786964849D+00
      C( 2)= 0.368983318148170127D+02
      C( 3)=-0.862953847800979020D+04
      C( 4)= 0.616414555988702341D+06
      C( 5)=-0.224837692867042422D+08
      C( 6)= 0.442699900539882660D+09
      C( 7)=-0.431210636544939327D+10
      C( 8)= 0.148558838775511398D+11
      C( 9)=-0.317605248014272630D+09
      C(10)= 0.374148111458616577D+12
      C(11)= 0.266737770092470627D+00
      C(12)=-0.210741782847390147D+00
      C(13)= 0.101634586991167734D-01
      C(14)=-0.395838531939912571D+03
      C(15)= 0.298588226648417887D+00
      C(16)= 0.299430688776365861D+00
      C(17)= 0.799635468897632928D+00
      C(18)= 0.439191465042685469D+00
      C(19)= 0.158695418480965822D+01
      C(20)= 0.138708213744285547D+01

      BSORDER=4

      POLORDER=10

      NCBAS=2*BSORDER+2

      NCPOL=POLORDER

      ALLOCATE(BS(NCBAS))

      DO I=1,NCBAS
        BS(I)=0.00D+00
      END DO

      DO I=1,NCBAS
        J=NCPOL+I
        BS(I)=C(J)
      END DO
 
      Y=0.00D+00
      POT=0.00D+00

      CALL BASIS_CONTRACT(1,BSORDER,BS,R,Y)

      DO I=1,POLORDER
        POT=POT+(Z(1)*Z(2)/R)*C(I)*Y**(DBLE(I))
      END DO

!###### CALCULATING ANALYTIC DERIVATIVES IF DER=.TRUE.

      IF (DER) THEN 
        CALL DBASIS_CONTRACT(1,BSORDER,BS,R,DYDR)
        DVDRPART1=-POT/R
        DVDRPART2=0.00D+00
        DO I=1,POLORDER
          DVDRPART2=DVDRPART2+(Z(1)*Z(2)/R)*C(I)*DBLE(I)*Y**(DBLE(I-1))
        END DO
        DVDRPART2=DVDRPART2*DYDR
        DVDR=DVDRPART1+DVDRPART2
      ELSE
        DVDR=1000
      ENDIF

!###### 

      DEALLOCATE(BS)

      RETURN
      END 

!######################################################################################################

      SUBROUTINE BASIS_CONTRACT(DEG,M,C,R,YVAL)
      IMPLICIT NONE
      INTEGER :: I,J,DEG
      INTEGER :: M
      DOUBLE PRECISION :: RREF0,ZETA
      DOUBLE PRECISION, DIMENSION(2*M+2) :: C
      DOUBLE PRECISION, DIMENSION(M) :: GAMA,VAL
      DOUBLE PRECISION :: R,YVAL

      DO I=1,M
        GAMA(I)=C(M+I)
      END DO

      RREF0=C(2*M+1)
      ZETA=C(2*M+2)

      DO I=1,M-1
        CALL PHISECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,R,VAL(I))
      END DO

      DO I=M,M
        CALL PHICSECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,6,R,VAL(I))
      END DO

      YVAL=0.00D+00

      DO J=1,M
        YVAL=YVAL+C(J)*VAL(J)
      END DO

      RETURN
      END

!######################################################################################################

      SUBROUTINE PHISECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,R,VAL)
      IMPLICIT NONE
      INTEGER :: DEG, IND, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, ORIG
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      VAL=(SECH(GAMA*RHO))**(DBLE(ETA))
      RETURN
      END

!######################################################################################################

      SUBROUTINE PHICSECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,LR,R,VAL)
      IMPLICIT NONE
      INTEGER :: DEG, IND, LR, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, BETA, FAC, ORIG
      BETA=1.00D+00/5.0D+00
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      FAC=(TANH(BETA*R)/R)**(DBLE(LR))
      VAL=FAC*(SECH(GAMA*RHO))**(DBLE(ETA))
      RETURN
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION ORIG(IND,ZETA,RREF0)
      IMPLICIT NONE
      INTEGER :: IND
      DOUBLE PRECISION :: ZETA,RREF0
      ORIG=ZETA*(RREF0)**(DBLE(IND)-1.0D+00)
      RETURN
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION SECH(X)
      IMPLICIT NONE
      DOUBLE PRECISION :: X
      SECH=1.00D+00/(COSH(X))      
      RETURN
      END

!######################################################################################################
! ANALYTIC DERIVATIVES OF THE BASIS SET CONTRACTION
!######################################################################################################

      SUBROUTINE DBASIS_CONTRACT(DEG,M,C,R,DYDR)
      IMPLICIT NONE
      INTEGER :: I,J,DEG
      INTEGER :: M
      DOUBLE PRECISION :: RREF0,ZETA
      DOUBLE PRECISION, DIMENSION(2*M+2) :: C
      DOUBLE PRECISION, DIMENSION(M) :: GAMA,DPHIDR
      DOUBLE PRECISION :: R,DYDR

      DO I=1,M
        GAMA(I)=C(M+I)
      END DO

      RREF0=C(2*M+1)
      ZETA=C(2*M+2)

      DO I=1,M-1
        CALL DPHISECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,R,DPHIDR(I))
      END DO

      DO I=M,M
        CALL DPHICSECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,6,R,DPHIDR(I))
      END DO

      DYDR=0.00D+00

      DO J=1,M
        DYDR=DYDR+C(J)*DPHIDR(J)
      END DO

      RETURN
      END

!######################################################################################################
! ANALYTIC DERIVATIVES OF THE PHISECBASIS
!######################################################################################################

      SUBROUTINE DPHISECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,R,DPHIDR)
      IMPLICIT NONE
      INTEGER :: DEG, IND, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, ORIG
      DOUBLE PRECISION :: PART1,PART2
      DOUBLE PRECISION :: DPHIDR
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      PART1=(SECH(GAMA*RHO))**(DBLE(ETA))
      PART2=(TANH(GAMA*RHO))
      DPHIDR=-(DBLE(ETA))*GAMA*PART1*PART2
      RETURN
      END

!######################################################################################################
! ANALYTIC DERIVATIVES OF THE PHISECBASIS
!######################################################################################################

      SUBROUTINE DPHICSECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,LR,R,DPHIDR)
      IMPLICIT NONE
      INTEGER :: DEG, IND, LR, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, BETA, FAC, ORIG
      DOUBLE PRECISION :: FAC1PART1,FAC2PART1
      DOUBLE PRECISION :: FAC3PART1,FAC1PART2
      DOUBLE PRECISION :: FAC2PART2,FAC3PART2
      DOUBLE PRECISION :: PART1,PART2
      DOUBLE PRECISION :: DPHIDR
      BETA=1.00D+00/5.0D+00
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      FAC1PART1=(TANH(BETA*R)/R)**(DBLE(LR-1))
      FAC2PART1=(BETA*(SECH(BETA*R))**(2)/R)-(TANH(BETA*R)/R**2)
      FAC3PART1=(SECH(GAMA*RHO))**(DBLE(ETA))
      PART1=(DBLE(LR))*FAC1PART1*FAC2PART1*FAC3PART1
      FAC1PART2=(SECH(GAMA*RHO))**(DBLE(ETA))
      FAC2PART2=(TANH(GAMA*RHO))
      FAC3PART2=(TANH(BETA*R)/R)**(DBLE(LR))
      PART2=-(DBLE(ETA))*GAMA*FAC1PART2*FAC2PART2*FAC3PART2
      DPHIDR=PART1+PART2
      RETURN
      END
